<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Cilium - It&#39;s still just BGP... | Frederiks Blog</title>
<meta name="keywords" content="tech, cisco, network, cilium, k3s, k8s, cni">
<meta name="description" content="Cilium - It&rsquo;s still just BGP&hellip; Continuing on my Cilium journey, here is what the Cilium BGP config for my lab looks like at the moment.
Like (basically?) everything else in kubernetes, the BGP config is also specified in YAML. In my lab all of my BGP config exists in a single YAML file that contains multiple YAML documents, with each YAML document being separated by 3 dashes ---.
The first YAML document is of the kind CiliumBGPClusterConfig, and it should be mostly self-explanatory as long as you&rsquo;ve worked with BGP on a &rsquo;traditional&rsquo; network device ðŸ™‚ I have a single BGP instance, called instance-65010, using the ASN 65010 with a single BGP peer with the name dc-switch with IP 192.">
<meta name="author" content="Frederik Fibiger-Lundberg">
<link rel="canonical" href="https://blog.flundberg.com/tech/cilium-still-just-bgp/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://blog.flundberg.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.flundberg.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.flundberg.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.flundberg.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.flundberg.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://blog.flundberg.com/tech/cilium-still-just-bgp/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Cilium - It&#39;s still just BGP..." />
<meta property="og:description" content="Cilium - It&rsquo;s still just BGP&hellip; Continuing on my Cilium journey, here is what the Cilium BGP config for my lab looks like at the moment.
Like (basically?) everything else in kubernetes, the BGP config is also specified in YAML. In my lab all of my BGP config exists in a single YAML file that contains multiple YAML documents, with each YAML document being separated by 3 dashes ---.
The first YAML document is of the kind CiliumBGPClusterConfig, and it should be mostly self-explanatory as long as you&rsquo;ve worked with BGP on a &rsquo;traditional&rsquo; network device ðŸ™‚ I have a single BGP instance, called instance-65010, using the ASN 65010 with a single BGP peer with the name dc-switch with IP 192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.flundberg.com/tech/cilium-still-just-bgp/" /><meta property="article:section" content="tech" />
<meta property="article:published_time" content="2026-01-30T10:07:35+01:00" />
<meta property="article:modified_time" content="2026-01-30T10:07:35+01:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cilium - It&#39;s still just BGP..."/>
<meta name="twitter:description" content="Cilium - It&rsquo;s still just BGP&hellip; Continuing on my Cilium journey, here is what the Cilium BGP config for my lab looks like at the moment.
Like (basically?) everything else in kubernetes, the BGP config is also specified in YAML. In my lab all of my BGP config exists in a single YAML file that contains multiple YAML documents, with each YAML document being separated by 3 dashes ---.
The first YAML document is of the kind CiliumBGPClusterConfig, and it should be mostly self-explanatory as long as you&rsquo;ve worked with BGP on a &rsquo;traditional&rsquo; network device ðŸ™‚ I have a single BGP instance, called instance-65010, using the ASN 65010 with a single BGP peer with the name dc-switch with IP 192."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "",
      "item": "https://blog.flundberg.com/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Cilium - It's still just BGP...",
      "item": "https://blog.flundberg.com/tech/cilium-still-just-bgp/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Cilium - It's still just BGP...",
  "name": "Cilium - It\u0027s still just BGP...",
  "description": "Cilium - It\u0026rsquo;s still just BGP\u0026hellip; Continuing on my Cilium journey, here is what the Cilium BGP config for my lab looks like at the moment.\nLike (basically?) everything else in kubernetes, the BGP config is also specified in YAML. In my lab all of my BGP config exists in a single YAML file that contains multiple YAML documents, with each YAML document being separated by 3 dashes ---.\nThe first YAML document is of the kind CiliumBGPClusterConfig, and it should be mostly self-explanatory as long as you\u0026rsquo;ve worked with BGP on a \u0026rsquo;traditional\u0026rsquo; network device ðŸ™‚ I have a single BGP instance, called instance-65010, using the ASN 65010 with a single BGP peer with the name dc-switch with IP 192.",
  "keywords": [
    "tech", "cisco", "network", "cilium", "k3s", "k8s", "cni"
  ],
  "articleBody": "Cilium - Itâ€™s still just BGPâ€¦ Continuing on my Cilium journey, here is what the Cilium BGP config for my lab looks like at the moment.\nLike (basically?) everything else in kubernetes, the BGP config is also specified in YAML. In my lab all of my BGP config exists in a single YAML file that contains multiple YAML documents, with each YAML document being separated by 3 dashes ---.\nThe first YAML document is of the kind CiliumBGPClusterConfig, and it should be mostly self-explanatory as long as youâ€™ve worked with BGP on a â€™traditionalâ€™ network device ðŸ™‚ I have a single BGP instance, called instance-65010, using the ASN 65010 with a single BGP peer with the name dc-switch with IP 192.168.100.1 in ASN 64999. The BGP peer config has a named reference to peer-config-generic, which references the next YAML document - Notice the name on line 15 ðŸ™‚\nThis next YAML document is of the kind CiliumBGPPeerConfig and specifies our peer config, including the address-family (AFI) and subsequent AFI (SAFI) which in this case is unicast - In â€˜Cisco BGPâ€™ the SAFI could also be VPNv4, etc.. Lastly it has an advertisement block that will match ressources with the label-combination advertise: \"ns-default-advertisement\".\nThe last two YAML documents starting on line 28 and 38 are both of the kind CiliumBGPAdvertisement. If we look under their respective spec block, we can see they have a unique name (ns-default-podcidr and ns-default-service) and a labels block, where we can see we have added the label-combination advertise: ns-default-advertisement that we also specified in the CiliumBGPPeerConfig YAML document.\nThe first CiliumBGPAdvertisement will make Cilium advertise the PodCIDR assigned to each of our k8s nodes (more on this another time), based on the advertisementType: \"PodCIDR\". The second one will advertise the IP addressâ€™ of any services that have been assigned a LoadBalancerIP (again more on this another time), and the last somewhat confusing part is the selector block on line 51-53, which as the comment says will simply match any services.\nThe result (luckily!) is that Cilium can now advertise services I deploy in the cluster to the rest of my homelab network using BGP - One of the two ways (at least as far as I know) to advertise services hosted in k8s.\nAnd for the BGP config on my Cisco switch And verifying that we are receiving the BGP routes from the k3s nodes The 10.42.x.0/24 routes are the PodCIDR routes, each k3s node only advertises its own PodCIDR. The 192.168.101.x/32 routes are the LoadBalancerIP Service routes, in my current setup each k3s node will advertise all services routes.\n",
  "wordCount" : "434",
  "inLanguage": "en",
  "datePublished": "2026-01-30T10:07:35+01:00",
  "dateModified": "2026-01-30T10:07:35+01:00",
  "author":{
    "@type": "Person",
    "name": "Frederik Fibiger-Lundberg"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.flundberg.com/tech/cilium-still-just-bgp/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Frederiks Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.flundberg.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.flundberg.com/" accesskey="h" title="Frederiks Blog (Alt + H)">Frederiks Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://blog.flundberg.com/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://blog.flundberg.com/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://blog.flundberg.com/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Cilium - It&#39;s still just BGP...
    </h1>
    <div class="post-meta"><span title='2026-01-30 10:07:35 +0100 +0100'>January 30, 2026</span>&nbsp;Â·&nbsp;3 min&nbsp;Â·&nbsp;Frederik Fibiger-Lundberg

</div>
  </header> 
  <div class="post-content"><h2 id="cilium---its-still-just-bgp">Cilium - It&rsquo;s still just BGP&hellip;<a hidden class="anchor" aria-hidden="true" href="#cilium---its-still-just-bgp">#</a></h2>
<p>Continuing on my Cilium journey, here is what the Cilium BGP config for my lab looks like at the moment.</p>
<p>Like (basically?) everything else in kubernetes, the BGP config is also specified in YAML. In my lab all of my BGP config exists in a single YAML file that contains multiple YAML documents, with each YAML document being separated by 3 dashes <code>---</code>.</p>
<p><img loading="lazy" src="cilium-bgp-config.png" alt="Homelab Cilium BGP Config"  />
</p>
<p>The first YAML document is of the kind <code>CiliumBGPClusterConfig</code>, and it should be mostly self-explanatory as long as you&rsquo;ve worked with BGP on a &rsquo;traditional&rsquo; network device ðŸ™‚ I have a single BGP instance, called <code>instance-65010</code>, using the ASN 65010 with a single BGP peer with the name <code>dc-switch</code> with IP <code>192.168.100.1</code> in ASN 64999. The BGP peer config has a named reference to <code>peer-config-generic</code>, which references the next YAML document - Notice the name on line 15 ðŸ™‚</p>
<p>This next YAML document is of the kind <code>CiliumBGPPeerConfig</code> and specifies our peer config, including the address-family (AFI) and subsequent AFI (SAFI) which in this case is unicast - In &lsquo;Cisco BGP&rsquo; the SAFI could also be VPNv4, etc.. Lastly it has an <code>advertisement</code> block that will match ressources with the label-combination <code>advertise: &quot;ns-default-advertisement&quot;</code>.</p>
<p>The last two YAML documents starting on line 28 and 38 are both of the kind <code>CiliumBGPAdvertisement</code>. If we look under their respective <code>spec</code> block, we can see they have a unique name (<code>ns-default-podcidr</code> and <code>ns-default-service</code>) and a <code>labels</code> block, where we can see we have added the label-combination <code>advertise: ns-default-advertisement</code> that we also specified in the <code>CiliumBGPPeerConfig</code> YAML document.</p>
<p>The first <code>CiliumBGPAdvertisement</code> will make Cilium advertise the <code>PodCIDR</code> assigned to each of our k8s nodes (more on this another time), based on the <code>advertisementType: &quot;PodCIDR&quot;</code>.
The second one will advertise the IP address&rsquo; of any services that have been assigned a <code>LoadBalancerIP</code> (again more on this another time), and the last somewhat confusing part is the <code>selector</code> block on line 51-53, which as the comment says will simply match any services.</p>
<p>The result (luckily!) is that Cilium can now advertise services I deploy in the cluster to the rest of my homelab network using BGP - One of the two ways (at least as far as I know) to advertise services hosted in k8s.</p>
<p>And for the BGP config on my Cisco switch
<img loading="lazy" src="dc-switch-bgp-config.png" alt="Cisco switch BGP config"  />
</p>
<p>And verifying that we are receiving the BGP routes from the k3s nodes
<img loading="lazy" src="dc-switch-bgp-verification.png" alt="Cisco switch BGP verficication"  />

The 10.42.x.0/24 routes are the <code>PodCIDR</code> routes, each k3s node only advertises its own PodCIDR.
The 192.168.101.x/32 routes are the <code>LoadBalancerIP</code> Service routes, in my current setup each k3s node will advertise all services routes.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://blog.flundberg.com/tags/tech/">Tech</a></li>
      <li><a href="https://blog.flundberg.com/tags/cisco/">Cisco</a></li>
      <li><a href="https://blog.flundberg.com/tags/network/">Network</a></li>
      <li><a href="https://blog.flundberg.com/tags/cilium/">Cilium</a></li>
      <li><a href="https://blog.flundberg.com/tags/k3s/">K3s</a></li>
      <li><a href="https://blog.flundberg.com/tags/k8s/">K8s</a></li>
      <li><a href="https://blog.flundberg.com/tags/cni/">Cni</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="https://blog.flundberg.com/">Frederiks Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
